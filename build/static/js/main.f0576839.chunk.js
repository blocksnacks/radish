(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{335:function(e,t,n){},353:function(e,t,n){e.exports=n(722)},358:function(e,t,n){},368:function(e,t){},370:function(e,t){},403:function(e,t){},404:function(e,t){},662:function(e,t){},714:function(e,t,n){},719:function(e,t,n){},720:function(e,t,n){},721:function(e,t,n){},722:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(21),l=n.n(c),i=n(48),u=(n(358),n(9)),o=n.n(u),s=n(24),m=n(15),p=n(30),f=n(75),d=n(217),b=new d.UserSession({appConfig:new d.AppConfig(["store_write","publish_data"])});Object(p.configure)({apiServer:Object({NODE_ENV:"production",PUBLIC_URL:""}).DOMAIN||"https://sendfriend.herokuapp.com",userSession:b});var E=Object(a.createContext)(),h=n(759),v=(n(714),function(e){var t=e.nullUsername,n=Object(a.useContext)(E),c=n.userSession;return n.loggedIn?r.a.createElement(f.a,{to:"/"}):r.a.createElement("div",{className:"App"},r.a.createElement("header",{className:"App-header"},r.a.createElement("div",{className:"sign-in"},r.a.createElement("h5",null,"Elegant, secure file sharing \n on the blockchain"),r.a.createElement(h.a,{fullWidth:!0,onClick:function(){return c.redirectToSignIn()},variant:"contained",color:"primary"},"Log in"),t&&r.a.createElement("p",null,"Your username is not yet registered. Please come back again once your registration process is complete."))))}),O=n(761),j=n(781),g=n(762),S=Object(f.g)(function(e){var t=e.location.pathname,n=Object(a.useContext)(E).userSession,c=Object(a.useState)("/upload"===t?"/":t),l=Object(m.a)(c,2),u=l[0],o=l[1];return r.a.createElement(O.a,null,r.a.createElement(j.a,{value:u,onChange:function(e,t){return o(t)},indicatorColor:"primary",textColor:"primary",centered:!0},r.a.createElement(g.a,{label:"Create Group",to:"/",value:"/",component:i.b}),r.a.createElement(g.a,{label:"Shared With Me",to:"/shared",value:"/shared",component:i.b}),r.a.createElement(g.a,{label:"Logout",variant:"contained",color:"primary",onClick:function(){return n.signUserOut(Object({NODE_ENV:"production",PUBLIC_URL:""}).DOMAIN||"https://sendfriend.herokuapp.com")}})))}),y=function(e){return function(t){return r.a.createElement(r.a.Fragment,null,r.a.createElement(S,null),r.a.createElement(e,t))}},w=function(e){return function(t){return Object(a.useContext)(E).userSession.isUserSignedIn()?r.a.createElement(e,t):r.a.createElement(f.a,{to:"/login"})}},k=n(783),x=n(763),N=n(767),C=n(764),U=n(765),I=n(780),P=function(e){var t=e.setEmailNotEntered,n=Object(a.useState)(""),c=Object(m.a)(n,2),l=c[0],i=c[1],u=Object(a.useState)(!0),f=Object(m.a)(u,2),d=f[0],b=f[1],E=Object(a.useState)(!1),v=Object(m.a)(E,2),O=v[0],j=v[1],g=Object(a.useState)(!1),S=Object(m.a)(g,2),y=S[0],w=S[1];return Object(a.useEffect)(function(){O&&function(){var e=Object(s.a)(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.Central.save("UserSettings",{email:l});case 3:b(!1),t(!1),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0),w(!0);case 11:case"end":return e.stop()}},e,null,[[0,7]])}));return function(){return e.apply(this,arguments)}}()()},[O,l,t]),r.a.createElement(k.a,{open:d},r.a.createElement(x.a,null,"Please Enter Your Email"),r.a.createElement(C.a,null,r.a.createElement(U.a,null,y?"Something went wrong. Please reload the page.":"In order to share files with other users, you must enter your email address."),r.a.createElement(I.a,{autoFocus:!0,margin:"dense",label:"Email Address",type:"email",fullWidth:!0,onChange:function(e){return i(e.target.value)},value:l})),r.a.createElement(N.a,null,r.a.createElement(h.a,{onClick:function(){return j(!0)},color:"primary",disabled:O||!l},"Sign Up")))},A=n(158),_=n(766),F=n(779),G=n(784),D=function(e){var t=e.selectUser,n=e.deselectUser,c=e.selectedUsers,l=Object(a.useState)(""),i=Object(m.a)(l,2),u=i[0],o=i[1],s=Object(a.useState)([]),f=Object(m.a)(s,2),d=f[0],b=f[1];return Object(a.useEffect)(function(){u.length>2?p.User.fetchList({username:{$regex:u},limit:15,fields:"username"}).then(function(e){b(e.map(function(e){return e.attrs.username}))}):b([])},[u]),r.a.createElement(r.a.Fragment,null,r.a.createElement(_.a,{fullWidth:!0,value:u,onChange:function(e){return o(e.target.value)}}),c.length?c.map(function(e){return r.a.createElement(G.a,{key:e,value:e,onClick:function(){return n(e)}},"Selected: ",e)}):null,d.length?d.filter(function(e){return!c.includes(e)}).map(function(e){return r.a.createElement(G.a,{key:e,value:e,onClick:function(){return t(e)}},e)}):null)},B=function(){var e=Object(s.a)(o.a.mark(function e(t,n,a){var r;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={recipients:t,creator:a.loadUserData().username,groupName:n},e.prev=1,e.next=4,fetch("/email/invite-users/",{method:"POST",body:JSON.stringify(r),headers:{"Content-Type":"application/json"}});case 4:return e.next=6,e.sent.json();case 6:return e.abrupt("return",e.sent);case 9:return e.prev=9,e.t0=e.catch(1),console.error(e.t0),e.abrupt("return","ErrorPostingEmails");case 13:case"end":return e.stop()}},e,null,[[1,9]])}));return function(t,n,a){return e.apply(this,arguments)}}(),T=Object(f.g)(function(e){var t=e.history,n=Object(a.useContext)(E),c=n.userSession,l=n.setUserGroup,i=Object(a.useState)(""),u=Object(m.a)(i,2),f=u[0],d=u[1],b=Object(a.useState)(null),v=Object(m.a)(b,2),O=v[0],j=v[1],g=Object(a.useState)([]),S=Object(m.a)(g,2),y=S[0],w=S[1],k=Object(a.useState)(""),x=Object(m.a)(k,2),N=x[0],C=x[1],U=Object(a.useState)([]),I=Object(m.a)(U,2)[1],P=Object(a.useState)([]),T=Object(m.a)(P,2),L=T[0],z=T[1];Object(a.useEffect)(function(){p.UserGroup.myGroups().then(z)},[]);var W=function(){var e=Object(s.a)(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(f){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,new p.UserGroup({name:f}).create();case 4:t=e.sent,j(t),C(t),z(function(e){return e.concat(t)});case 8:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),R=function(){var e=Object(s.a)(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.all(y.map(function(){var e=Object(s.a)(o.a.mark(function e(t){var n,a;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.makeGroupMembership(t);case 2:return n=e.sent,a=n._id,e.abrupt("return",{blockstackId:t,inviteId:a});case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 3:t=e.sent,I(function(e){return[].concat(Object(A.a)(e),[t])}),B(t,f,c),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("fail to send invites: %o",e.t0);case 11:case"end":return e.stop()}},e,null,[[0,8]])}));return function(){return e.apply(this,arguments)}}();return r.a.createElement("div",null,r.a.createElement("div",{className:"form-container"},r.a.createElement("h2",null,"Choose a group to share with"),r.a.createElement(F.a,{onChange:function(e){return C(e.target.value)},value:N},L.map(function(e){return"string"===typeof e.attrs.name&&r.a.createElement(G.a,{value:e,key:e._id},e.attrs.name)})),r.a.createElement("h2",null,"...or create a new group"),r.a.createElement("div",null,r.a.createElement("h3",null,"Enter Usergroup Name"),r.a.createElement("div",{className:"input-container"},r.a.createElement(_.a,{autoFocus:!0,fullWidth:!0,value:f,onChange:function(e){var t=e.target;return d(t.value)}})),r.a.createElement(h.a,{variant:"contained",color:"primary",onClick:W,disabled:!O&&!f.length||!!O},"Create User Group")),r.a.createElement("div",null,r.a.createElement("h3",null,"Select Recipients"),r.a.createElement("div",{className:"input-container"},r.a.createElement(D,{selectUser:function(e){return w(y.concat(e))},deselectUser:function(e){var t=y.indexOf(e);w(y.slice(0,t).concat(y.slice(t+1)))},selectedUsers:y})),r.a.createElement(h.a,{variant:"contained",color:"primary",onClick:R,disabled:!O||!y.length},"Invite Users")),r.a.createElement(h.a,{variant:"contained",color:"secondary",onClick:function(){l(N),t.push("/upload")},disabled:!N},"Share With This Group")))}),L=w(y(function(){var e=Object(a.useContext)(E),t=e.emailNotEntered,n=e.setEmailNotEntered;return r.a.createElement("div",{className:"main-container"},t&&r.a.createElement(P,{setEmailNotEntered:n}),r.a.createElement(T,null))})),z=n(768),W=(n(719),function(){return r.a.createElement("div",{className:"circular-progress"},r.a.createElement(z.a,{size:100}))}),R=n(769),M=(n(720),function e(){return new Promise(function(e){return e()}).then(function(){return{activate:e}})}),J=w(y(function(e){var t=e.match.params,n=Object(a.useState)(!1),c=Object(m.a)(n,2),l=c[0],i=c[1];return Object(a.useEffect)(function(){Object(s.a)(o.a.mark(function e(){var n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M(t.invitation_id);case 2:return n=e.sent,e.next=5,n.activate();case 5:return e.next=7,new Promise(function(e){return setTimeout(e,3e3)});case 7:i(!0);case 8:case"end":return e.stop()}},e)}))()},[t.invitation_id]),l?r.a.createElement(f.a,{to:"/shared"}):r.a.createElement(R.a,null,r.a.createElement("div",{className:"content-container"},r.a.createElement("h3",{className:"invite-header"},"Accepting the invitation to share ",t.invitation_id,"... Please wait!"),r.a.createElement(W,null)))})),Y=n(770),V=n(771),K=n(772),$=n(773),q=n(774),H=n(775),Q=n(776),X=n(777),Z=n(341),ee=n.n(Z),te=(n(335),n(154)),ne=n(159),ae=n(155),re=n(160),ce=["_id","radiksType","createdAt","updatedAt","signingKeyId","radiksSignature"],le=function(e){function t(){return Object(te.a)(this,t),Object(ne.a)(this,Object(ae.a)(t).apply(this,arguments))}return Object(re.a)(t,e),t}(function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(te.a)(this,t),e=Object(ne.a)(this,Object(ae.a)(t).call(this,n));var a=new Set(ce.concat(Object.keys(e.schema)));return Object.keys(n).forEach(function(t){if(!a.has(t))throw new Error("".concat(t," is not in ").concat("function"===typeof e.modelName?e.modelName():""," schema"))}),e}return Object(re.a)(t,e),t}(p.Model));le.className="SharedDocument",le.schema={name:String,extension:String,mimeType:String,userGroupId:{type:String,decrypted:!0},uploadedBy:String,size:Number,content:String};var ie=Object(Y.a)(function(e){return{fab:{margin:e.spacing(1)},button:{margin:e.spacing(1)}}}),ue=w(y(function(){var e=ie(),t=Object(a.useState)([]),n=Object(m.a)(t,2),c=n[0],l=n[1],i=Object(a.useState)(!1),u=Object(m.a)(i,2),p=u[0],f=u[1],d=Object(a.useState)(!1),b=Object(m.a)(d,2),E=b[0],v=b[1],O=Object(a.useState)(!1),j=Object(m.a)(O,2),g=j[0],S=j[1],y=Object(a.useState)(null),w=Object(m.a)(y,2),k=w[0],x=w[1];return Object(a.useEffect)(function(){Object(s.a)(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,v(!0),e.next=4,le.fetchList();case 4:e.t0=function(e){return"string"===typeof e.attrs.name},e.t1=function(e){var t=e.attrs;return{id:t._id,name:t.name,createdDate:t.createdAt,size:t.size,uploadedBy:t.uploadedBy,content:t.content,mimeType:t.mimeType}},t=e.sent.filter(e.t0).map(e.t1),v(!1),l(t),e.next=15;break;case 11:e.prev=11,e.t2=e.catch(0),console.error(e.t2),f(!0);case 15:case"end":return e.stop()}},e,null,[[0,11]])}))()},[]),Object(a.useEffect)(function(){Object(s.a)(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:g&&k&&((t=document.createElement("a")).href=k.content,t.download=k.name,t.click(),x(null),S(!1));case 1:case"end":return e.stop()}},e)}))()},[g,k]),r.a.createElement("div",null,r.a.createElement("h2",{className:"table-title"},"Files Shared with me"),p?r.a.createElement("div",null,"Error retrieving shared files"):c.length?r.a.createElement("div",{className:"table-container"},r.a.createElement(V.a,null,r.a.createElement(K.a,null,r.a.createElement($.a,null,r.a.createElement(q.a,null,"File ID"),r.a.createElement(q.a,null,"File Name"),r.a.createElement(q.a,null,"Created At"),r.a.createElement(q.a,null,"Size"),r.a.createElement(q.a,null,"Uploaded By"),r.a.createElement(q.a,null,"Download"))),r.a.createElement(H.a,null,c.map(function(t){return r.a.createElement($.a,{key:t.id},r.a.createElement(q.a,null,t.id),r.a.createElement(q.a,null,t.name),r.a.createElement(q.a,null,t.createdDate),r.a.createElement(q.a,null,ee()(t.size)),r.a.createElement(q.a,null,t.uploadedBy),r.a.createElement(q.a,null,r.a.createElement(h.a,{disabled:g,onClick:function(){x(t),S(!0)}},r.a.createElement(Q.a,{"aria-label":"download",component:"span",color:"primary",className:e.fab},r.a.createElement(X.a,null)))))})))):E?r.a.createElement(W,null):r.a.createElement("div",{className:"table-container"},r.a.createElement("div",null,"You don't have any documents")))})),oe=n(778),se=(n(721),Object(Y.a)(function(e){return{fab:{margin:e.spacing(1)},button:{margin:e.spacing(1)}}})),me=w(y(Object(f.g)(function(e){var t=e.history,n=Object(a.useContext)(E),c=n.userGroup,l=n.userSession,i=se(),u=Object(a.useRef)(null),p=Object(a.useState)(null),d=Object(m.a)(p,2),b=d[0],v=d[1],O=Object(a.useState)(!1),j=Object(m.a)(O,2),g=j[0],S=j[1];Object(a.useEffect)(function(){!function(){var e=Object(s.a)(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!g){e.next=5;break}return S(!1),e.next=4,Promise.all(b.map(function(e){return new Promise(function(n){var a=new FileReader;a.onload=function(){var a=Object(s.a)(o.a.mark(function a(r){var i,u;return o.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return i=r.target.result,u=new le({name:e.name,extension:e.name.split(".").pop(),mimeType:e.type,userGroupId:c._id,uploadedBy:l.loadUserData().username,size:e.size,content:i}),a.next=4,u.save();case 4:t.push("/shared"),n();case 6:case"end":return a.stop()}},a)}));return function(e){return a.apply(this,arguments)}}(),a.readAsDataURL(e)})}));case 4:v(null);case 5:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()()},[b,c,l,g,t]);return c?r.a.createElement("div",{className:"share-wrapper"},r.a.createElement("h2",{className:"share-header"},"Share with ",c.attrs.name),r.a.createElement("div",{className:"share-file-container"},r.a.createElement("section",{className:"share-file-main"},r.a.createElement("div",{className:"share-file-upload-file"},r.a.createElement("input",{id:"hidden-file-input",multiple:!0,type:"file",ref:u,onChange:function(){return v(Array.from(u.current.files))}}),r.a.createElement("label",{htmlFor:"hidden-file-input"},r.a.createElement(Q.a,{"aria-label":"add",component:"span",color:"primary",className:i.fab},r.a.createElement(oe.a,null))),r.a.createElement("p",{className:"no-margin"},"Click to add"),r.a.createElement("p",{className:"no-margin center"},"files to share"),b&&b.length&&r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"file-list"},r.a.createElement("h4",null,"Files to share:"),r.a.createElement("ul",null,b.map(function(e){return r.a.createElement("li",{className:"no-margin",key:e.name},e.name)}))),r.a.createElement(h.a,{variant:"contained",color:"primary",className:i.button,onClick:function(){v(Array.from(u.current.files)),b&&b.length&&S(!0)},fullWidth:!0},"Send Files"))),r.a.createElement("div",{className:"share-file-description"},r.a.createElement("h1",{className:"no-margin"}," Simple Private BlockSnack File Sharing"),r.a.createElement("p",null,"Add the files you'd like to share with your group"))))):r.a.createElement(f.a,{to:"/"})}))),pe=function(){var e=Object(a.useContext)(E).userSession,t=Object(a.useState)(!0),n=Object(m.a)(t,2),c=n[0],l=n[1];return Object(a.useEffect)(function(){!function(){var t=Object(s.a)(o.a.mark(function t(){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.isUserSignedIn()||!e.isSignInPending()){t.next=5;break}return t.next=3,e.handlePendingSignIn();case 3:return t.next=5,p.User.createWithCurrentUser();case 5:l(!1);case 6:case"end":return t.stop()}},t)}));return function(){return t.apply(this,arguments)}}()()},[e]),r.a.createElement(r.a.Fragment,null,r.a.createElement(f.d,null,r.a.createElement(f.b,{exact:!0,path:"/login",component:v}),"}",r.a.createElement(f.b,{exact:!0,path:"/",component:c?W:L}),r.a.createElement(f.b,{exact:!0,path:"/upload",component:me}),r.a.createElement(f.b,{exact:!0,path:"/shared",component:ue}),r.a.createElement(f.b,{path:"/invitation/:invitation_id",component:J})))};l.a.render(r.a.createElement(function(e){var t=e.children,n=Object(a.useState)(null),c=Object(m.a)(n,2),l=c[0],i=c[1],u=Object(a.useState)(b.isUserSignedIn()),f=Object(m.a)(u,2),d=f[0],h=f[1],v=Object(a.useState)(!1),O=Object(m.a)(v,2),j=O[0],g=O[1];return Object(a.useEffect)(function(){Object(s.a)(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!d){e.next=7;break}return e.next=3,p.Central.get("UserSettings");case 3:t=e.sent,g(!t||!t.email),e.next=8;break;case 7:h(!1);case 8:case"end":return e.stop()}},e)}))()},[d]),r.a.createElement(E.Provider,{value:{userSession:b,userGroup:l,setUserGroup:i,emailNotEntered:j,setEmailNotEntered:g,loggedIn:d}},t)},null,r.a.createElement(i.a,null,r.a.createElement(pe,null))),document.getElementById("root"))}},[[353,1,2]]]);
//# sourceMappingURL=main.f0576839.chunk.js.map